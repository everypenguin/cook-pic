# システム管理者機能セットアップガイド

## 📋 概要

システム管理者機能により、店舗の管理やシステム管理者の追加が可能になります。

## 🗄️ データベースセットアップ

### 1. Supabaseでマイグレーションを実行

1. Supabaseダッシュボードにログイン
2. 「SQL Editor」を開く
3. `supabase/migration_add_system_admin.sql`の内容をコピー＆ペースト
4. 「Run」をクリックして実行

### 2. デフォルトのシステム管理者

マイグレーション実行後、以下のデフォルトアカウントが作成されます：

- **ユーザー名**: `admin`
- **パスワード**: `admin123`
- **名前**: システム管理者

⚠️ **重要**: 本番環境では必ずパスワードを変更してください。

## 🔐 ログイン方法

### システム管理者ログイン
- **URL**: `/system-admin/login`
- **ユーザー名**: `admin`
- **パスワード**: `admin123`（初期パスワード）

### 店舗管理者ログイン
- **URL**: `/admin/login`
- **店舗ID**: システム管理者が作成した店舗ID
- **パスワード**: システム管理者が設定したパスワード

## 🎯 機能一覧

### システム管理者機能

1. **店舗管理**
   - 店舗の作成・編集・削除
   - 店舗ID、店舗名、パスワードの設定
   - プロフィール画像の設定

2. **システム管理者管理**（今後実装予定）
   - システム管理者の追加・編集・削除

3. **利用統計**（今後実装予定）
   - アクセス数の確認
   - 利用状況の分析

### 店舗管理者機能

1. **メニュー管理**
   - 日間メニューの投稿・編集・削除
   - 週間メニューの設定
   - 月間メニューの設定

2. **プロフィール管理**
   - 店舗情報の編集
   - プロフィール画像の変更

## 📝 店舗の作成方法

1. システム管理者でログイン
2. 「店舗管理」をクリック
3. 「新規店舗追加」をクリック
4. 以下の情報を入力：
   - **店舗ID**: 一意のID（例: `store-001`）
   - **店舗名**: 店舗の名前
   - **パスワード**: 店舗管理者のパスワード
   - **プロフィール画像URL**: オプション
5. 「作成」をクリック

## 🔒 セキュリティ

- システム管理者と店舗管理者は別々の認証システムを使用
- パスワードはbcryptでハッシュ化して保存
- トークンベースの認証を使用
- Row Level Security (RLS) でデータアクセスを制御

## 🚀 本番環境での設定

### 1. パスワードの変更

デフォルトのシステム管理者パスワードを変更：

```sql
-- Supabase SQL Editorで実行
UPDATE system_admins 
SET password_hash = '$2a$10$新しいパスワードのbcryptハッシュ'
WHERE username = 'admin';
```

bcryptハッシュの生成は、Node.jsで実行：

```javascript
const bcrypt = require('bcryptjs');
const hash = await bcrypt.hash('新しいパスワード', 10);
console.log(hash);
```

### 2. 環境変数の確認

Vercelの環境変数が正しく設定されているか確認：

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`

## 📚 関連ドキュメント

- [VERCEL_DEPLOY.md](./VERCEL_DEPLOY.md) - Vercelデプロイ手順
- [開発環境ログイン情報.md](./開発環境ログイン情報.md) - 開発環境のログイン情報


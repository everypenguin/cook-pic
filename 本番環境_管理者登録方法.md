# 本番環境での管理者と利用者の登録方法

## 📋 概要

本番環境（Vercelデプロイ後）での管理者と利用者の登録方法を説明します。

## 🔐 システム管理者の登録

### 初回セットアップ

1. **Supabaseでマイグレーションを実行**
   - Supabaseダッシュボードの「SQL Editor」を開く
   - `supabase/migration_add_system_admin.sql`の内容を実行
   - これにより、デフォルトのシステム管理者が作成されます

2. **デフォルトアカウントでログイン**
   - URL: `https://your-domain.vercel.app/system-admin/login`
   - ユーザー名: `admin`
   - パスワード: `admin123`

3. **パスワードを変更**（重要）
   - ログイン後、すぐにパスワードを変更してください
   - 現在はUIから変更できないため、Supabase SQL Editorで実行：

```sql
-- 新しいパスワードのbcryptハッシュを生成（Node.jsで実行）
-- const bcrypt = require('bcryptjs');
-- const hash = await bcrypt.hash('新しい強力なパスワード', 10);
-- console.log(hash);

-- Supabase SQL Editorで実行
UPDATE system_admins 
SET password_hash = '生成したbcryptハッシュ'
WHERE username = 'admin';
```

## 🏪 店舗管理者（店舗）の登録

### システム管理者が店舗を作成

1. **システム管理者でログイン**
   - `/system-admin/login`にアクセス

2. **店舗管理ページへ移動**
   - ダッシュボードから「店舗管理」をクリック

3. **新規店舗を追加**
   - 「新規店舗追加」ボタンをクリック
   - 以下の情報を入力：
     - **店舗ID**: 一意のID（例: `store-001`, `tokyo-shop-01`）
     - **店舗名**: 店舗の名前（例: `東京店`, `渋谷店`）
     - **パスワード**: 店舗管理者が使用するパスワード
     - **プロフィール画像URL**: オプション（Supabase StorageのURLなど）
   - 「作成」をクリック

4. **店舗管理者に情報を共有**
   - 作成した店舗IDとパスワードを店舗管理者に伝える
   - ログインURL: `/admin/login`

### 店舗管理者のログイン

1. **ログインページにアクセス**
   - URL: `https://your-domain.vercel.app/admin/login`

2. **ログイン情報を入力**
   - 店舗ID: システム管理者から受け取った店舗ID
   - パスワード: システム管理者から受け取ったパスワード

3. **店舗管理画面でメニューを管理**
   - 日間メニューの投稿
   - 週間メニューの設定
   - 月間メニューの設定
   - プロフィールの編集

## 👥 利用者の登録

利用者（一般ユーザー）の登録は**不要**です。

### 利用方法

1. **アクセスポイントに移動**
   - URL: `https://your-domain.vercel.app/user/access`

2. **店舗IDを入力**
   - 閲覧したい店舗の店舗IDを入力
   - 例: `store-001`, `tokyo-shop-01`

3. **メニューを閲覧**
   - 日間メニュー
   - 週間メニュー
   - 月間メニュー

## 🔄 店舗情報の編集・削除

### システム管理者が店舗を編集

1. **店舗管理ページで編集**
   - 店舗一覧から「編集」ボタンをクリック
   - 店舗名、パスワード、プロフィール画像を変更可能
   - 店舗IDは変更不可（一意性のため）

### 店舗の削除

1. **店舗管理ページで削除**
   - 店舗一覧から「削除」ボタンをクリック
   - 確認ダイアログで「OK」をクリック
   - ⚠️ **注意**: 店舗を削除すると、その店舗のすべてのメニューも削除されます

## 📝 まとめ

### 登録フロー

```
1. Supabaseでマイグレーション実行
   ↓
2. システム管理者でログイン（admin/admin123）
   ↓
3. パスワードを変更（重要！）
   ↓
4. 店舗を作成
   ↓
5. 店舗管理者に店舗IDとパスワードを共有
   ↓
6. 店舗管理者がログインしてメニューを管理
   ↓
7. 利用者が店舗IDを入力してメニューを閲覧
```

### 役割の違い

| 役割 | 登録方法 | できること |
|------|----------|------------|
| **システム管理者** | Supabaseマイグレーション | 店舗の作成・編集・削除、システム管理者の管理 |
| **店舗管理者** | システム管理者が作成 | 自分の店舗のメニュー管理、プロフィール編集 |
| **利用者** | 登録不要 | 店舗IDを入力してメニューを閲覧 |

## 🔒 セキュリティのベストプラクティス

1. **システム管理者のパスワード**
   - デフォルトパスワード（`admin123`）は必ず変更
   - 強力なパスワードを使用（12文字以上、大文字・小文字・数字・記号を含む）

2. **店舗管理者のパスワード**
   - 各店舗に異なるパスワードを設定
   - 定期的にパスワードを変更

3. **店舗ID**
   - 推測しにくいIDを使用
   - 例: `store-001` → `tokyo-shibuya-2024-001`

## 📚 関連ドキュメント

- [SYSTEM_ADMIN_SETUP.md](./SYSTEM_ADMIN_SETUP.md) - システム管理者機能の詳細
- [VERCEL_DEPLOY.md](./VERCEL_DEPLOY.md) - Vercelデプロイ手順

